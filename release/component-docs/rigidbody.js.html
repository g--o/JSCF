<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: rigidbody.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: rigidbody.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
/***************************
	rigid body component.
***************************/
const __RIGIDBODY_NAME = "[builtin_rigidbody]";
const __RIGIDBODY_BIAS = 10000;
const __RIGIDBODY_EPSILON = __RIGIDBODY_BIAS/Number.MAX_VALUE; //1/Infinity;
const __RIGIDBODY_STAIC_MASS = 1/__RIGIDBODY_EPSILON;

/**
 * @class
 * @classdesc rigidbody component class.
 *
 * @param       {Entity} owner the entity the component's being applied to.
 * @param 		{Number} tick_duration (defaults to the physics engine's tick duration)
 * 										the time (in seconds) of a tick (usually 1/fps).
 * @constructor
 */
var Rigidbody = function(owner, tick_duration)
{

	/**
	 *    sets parent (attches component to entity p)
	 *
	 *    @method
	 *    @param  {Entity} p entity to attach to (should be parent; parent can be object)
	 */
	this.setParent = function(p)
	{
		this.parent = p;
	};

	/**
	 *    sets rigidbody as static (infinite mass, does not move)
	 *
	 *    @method
	 */
	this.setStaticBody = function()
	{
		this.static = true;
		this.auto_gravity = false;
		this.mass = __RIGIDBODY_STAIC_MASS;
	};

	/**
	 *    auto-only updates rigidbody (tick)
	 *
	 *    @method
	 */
	this.update = function()
	{
		if (this.auto_update)
			this.tick_update();
	};

	/**
	 *    actual update function (tick)
	 *
	 *    @method
	 */
	this.tick_update = function()
	{
		// displace (integrate)
		this.parent.transform.pos.x += this.velocity.x * this.tickDuration;
		this.parent.transform.pos.y += this.velocity.y * this.tickDuration;
	};

	/**
	 *    resolve collision between this and other rigidbody
	 *
	 *    @method
	 *    @param  {Rigidbody} other  other rigidbody (that collides with this one)
	 *    @param  {Vector2d} normal collision normal
	 */
	this.calcCollision = function(other, normal)
	{
		// DEFINITIONS:
		const massA = this.mass;
		const massB = other.mass;
		const fCor = (this.cor + other.cor)/2;

    	const ut = new Vector2d(-normal.y,normal.x); 								// Tangent
		const v1 = this.velocity;
		const v2 = other.velocity;

    	var v1n = v1.dotProduct(normal); 										// Velocity in normal direction
    	var v1t = ut.dotProduct(v1); 											// Velocity in tangent direction
    	var v2n = normal.dotProduct(v2); 										// Velocity in normal direction
    	var v2t = ut.dotProduct(v2); 											// Velocity in tangent direction

		// APPLY MOMENTUM CONSERVATION:
    	var V1t = v1t
		var V2t = v2t;
    	var V1n = (v1n*(massA-fCor*massB)+(1+fCor)*massB*v2n)/(massA+massB); 	// Velocity size using my custom equation
    	var V2n = (v2n*(massB-fCor*massA)+(1+fCor)*massA*v1n)/(massA+massB); 	// Velocity size using my custom equation

    	var vV1n = new Vector2d(V1n*normal.x, V1n*normal.y);		 			// Getting the velocity for the normal direction
    	var vV1t = new Vector2d(V1t*ut.x, V1t*ut.y); 							// Getting the velocity for the tangent direction
    	var vV2n = new Vector2d(V2n*normal.x, V2n*normal.y); 					// Getting the velocity for the normal direction
    	var vV2t = new Vector2d(V2t*ut.x, V2t*ut.y); 							// Getting the velocity for the tangent direction

    	var fV1 = new Vector2d(vV1n.x+vV1t.x,vV1n.y+vV1t.y);					// Getting final velocity
    	var fV2 = new Vector2d(vV2n.x+vV2t.x,vV2n.y+vV2t.y);					// Getting final velocity

		if (!this.static)
			this.velocity = fV1;
		if (!other.static)
			other.velocity = fV2;
	};

	/**
	 *    fixes bodies penetration/energy loss
	 *
	 *    @method
	 *    @param  {Rigidbody} other  other rigidbody (that collides with this one)
	 *    @param  {Vector2d} penVec  penetration vector of the two rigidbodies
	 */
	this.fixPenetration = function(other, penVec)
	{
		var biasVec = penVec.clone();
		// biasVec.scalarMul(correction);

		if (!this.static)
			this.parent.transform.pos.addVector(penVec);
		if (!other.static)
			other.parent.transform.pos.subVector(penVec);
	};

	/**
	 *    applys acceleration to the rigidbody over the tick
	 *
	 *    @method
	 *    @param  {Vector2d} acceleration the acceleration vector
	 */
	this.applyAcceleration = function(acceleration)
	{
		// integrate to velocity &amp; apply
		var vel = acceleration.clone();
		vel.scalarMul(this.tickDuration);

		this.applyVelocity(vel);
	};

	/**
	 *    applys velocity to the rigidbody
	 *
	 *    @method
	 *    @param  {Vector2d} velocity the velocity to add over the tick
	 */
	this.applyVelocity = function(velocity)
	{
		this.velocity.addVector(velocity);
	};

	this.init = function()
	{
		this.name = __RIGIDBODY_NAME;
		this.parent = owner;

		if (tick_duration)
			this.tickDuration = tick_duration;
		else
			this.tickDuration = this.parent.game.getCurrentScene().physicsEngine.tickDuration;

		this.displacement = new Vector2d(0, 0);
		this.velocity = new Vector2d(0, 0);
		this.ro = 1;
		this.cor = 1;
		this.mass = this.parent.transform.scale.x * this.parent.transform.scale.y * this.ro;
		this.auto_gravity = true;
		this.auto_update = false;
		this.static = false;

		if (!this.parent.hasComponentOfType(Collider))
			console.error("[jscf/components/rigidbody] parent doesn't have collider.");
		if (!this.parent.transform)
			console.error("[jscf/components/rigidbody] parent doesn't have transform! Not an entity?");
	};
	this.init();
};

/**
 *    the component name
 *
 *    @type {String}
 */
Rigidbody.component_name = __RIGIDBODY_NAME;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ButtonHandler.html">ButtonHandler</a></li><li><a href="Collider.html">Collider</a></li><li><a href="Rigidbody.html">Rigidbody</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun Jul 08 2018 00:24:29 GMT+0300 (שעון קיץ ירושלים)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
