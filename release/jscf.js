function AABB(t,e,n,i){this.setTransform=function(t){this.pos=t.pos,this.reset()},this.containsPoint=function(t,e){return t>this.xMin&&t<this.xMax&&e<this.yMax&&e>this.yMin},this.isColliding=function(t){return this.xMin<t.xMax&&this.xMax>t.xMin&&this.yMin<t.yMax&&this.yMax>t.yMin},this.getPenetration=function(t){var e=this.pos.clone();e.subVector(t.pos);var n=Math.abs(Math.abs(e.x)-(this.dims.x+t.dims.x)/2),i=Math.abs(Math.abs(e.y)-(this.dims.y+t.dims.y)/2);return n<i?new Vector2d(e.x>0?n:-n,0):new Vector2d(0,e.y>0?i:-i)},this.getNormal=function(t){var e=this.getPenetration(t);return e.normalize(),e},this.reset=function(){this.xMin=this.pos.x-this.dims.x/2,this.yMin=this.pos.y-this.dims.y/2,this.xMax=this.xMin+this.dims.x,this.yMax=this.yMin+this.dims.y},this.init=function(t,e,n,i){this.pos=new Vector2d(t,e),this.dims=new Vector2d(n,i),this.type="aabb",this.reset()},this.init(t,e,n,i)}function CircleCollider(t,e,n){this.setTransform=function(t){this.pos=t.pos},this.containsPoint=function(t,e){var n=new Point2d(this.pos.x,this.pos.y),i=new Point2d(t,e);return n.distanceTo(i)<=this.R},this.isColliding=function(t){return Vector.subVector(this.pos-t.pos).length()<=this.R+t.R},this.getPenetration=function(t){var e=this.pos.clone();e.subVector(t.pos);var n=Math.abs(Math.abs(e.x)-(this.R+t.R)/2),i=Math.abs(Math.abs(e.y)-(this.R+t.R)/2);return new Vector2d(e.x>0?n:-n,e.y>0?i:-i)},this.getNormal=function(t){var e=this.getPenetration(t);return e.normalize(),e},this.init=function(t,e,n){this.pos=new Vector2d(t,e),this.R=n,this.type="circle",this.reset()},this.init(t,e,n)}function ButtonHandler(t,e){this.name=__BUTTON_HANDLER_NAME,this.parent=t,this.hover_speed=e?e:__BUTTON_HANDLER_HOVER_SPEED,this.pressed=!1,this.setDimentions=function(t,e){t>0&&(this.bb.dims.x=t),e>0&&(this.bb.dims.y=e),this.bb.reset()},this.update=function(){var e=t.getGlobalTransform();this.bb.setTransform(e);var n=t.game.inputManager.getMouseX(),i=t.game.inputManager.getMouseY(),r=t.game.inputManager.isMouseDown();this.bb.containsPoint(n,i)?(e.scale.length()<__BUTTON_HANDLER_HOVER_MAX&&t.transform.scale.scalarMul(this.hover_speed),r&&(this.pressed=!0)):t.transform.scale=new Vector2d(1,1),this.pressed&&!r&&(this.pressed=!1,this.onClick())},this.onClick=function(){console.log("[JSCF][ButtonHandler] button press")},this.init=function(){var e=t.getDimentions(),n=t.getGlobalTransform();this.bb=new AABB(n,n,e.x,e.y)},this.init()}function RectangleEditor(t,e){this.name=__RECTANGLE_EDITOR_NAME,this.parent=t,this.style=e?e:__RECTANGLE_DEFAULT_PASSIVE_STYLE,this.update=function(){var t=this.parent.getGlobalTransform();this.bb.setTransform(t);var e=this.parent.game.inputManager.getMouseX(),n=this.parent.game.inputManager.getMouseY(),i=new Vector2d(e,n);if(this.parent.game.inputManager.isRMBDown()&&this.isSelected()){var r=Vector.subVector(i,this.parent.transform.pos);r.scalarMul(2),this.parent.setDimentions(r.x,r.y),r=this.parent.getDimentions(),this.bb.dims=r,this.bb.reset(),this.rectangle.width=r.x,this.rectangle.height=r.y}this.bb.containsPoint(e,n)&&this.parent.game.inputManager.isMouseDown()&&this.parent.game.inputManager.isLMBDown()&&(this.selectOwner(),this.parent.transform.pos=i)},this.isSelected=function(){return RectangleEditor.currently_selected==this.parent},this.selectOwner=function(){if(RectangleEditor.currently_selected){var t=RectangleEditor.currently_selected.getComponentOfType(RectangleEditor);t&&t.deselectOwner()}RectangleEditor.currently_selected=this.parent,this.style=__RECTANGLE_DEFAULT_ACTIVE_STYLE,this.rectangle.color=this.style,this.circle.color=this.style},this.deselectOwner=function(){RectangleEditor.currently_selected=null,this.style=__RECTANGLE_DEFAULT_PASSIVE_STYLE,this.rectangle.color=this.style,this.circle.color=this.style},this.render=function(){this.rectangle.render(),this.circle.render()},this.init=function(){var t=this.parent.getDimentions(),e=this.parent.getGlobalTransform();this.rectangle=new Rectangle(game,t.x,t.y,this.style),this.circle=new Circle(game,5,this.style),this.bb=new AABB(e,e,t.x,t.y)},this.init()}function Entity(t,e,n,i,r,s){this.start_render=function(){var e=t.graphics.context;e.save(),e.translate(this.transform.pos.x,this.transform.pos.y),e.rotate(this.transform.angle),e.scale(this.transform.scale.x,this.transform.scale.y)},this.end_render=function(){t.graphics.context.restore()},this.render=function(){this.start_render();for(var t in this.children)this.children[t]&&this.children[t].render&&this.children[t].render();this.end_render()},this.update=function(){for(var t in this.children)this.children[t]&&this.children[t].update&&this.children[t].update()},this.hasOwnChild=function(t){return this.children[t]},this.getChild=function(t){var e=this.hasOwnChild(t);if(e)return e;for(var n in this.children)if(this.children.hasOwnProperty(n)&&this.children[n].getChild){var i=this.children[n].getChild(t);if(i)return i}},this.getChildAt=function(t){return Object.values(this.children)[t]},this.getComponent=function(t){return this.getChild("["+t+"]")},this.getBuiltinComponent=function(t){return this.getComponent("builtin_"+t)},this.getComponentOfType=function(t){var e=Component.typeToName(t),n=this.getChild(e);return n||(n=this.getBuiltinComponent(e)),n},this.hasComponentOfType=function(t){var e=Component.typeToName(t);return this.hasOwnChild(e)||this.hasOwnChild("[builtin_"+e+"]")},this.addComponent=function(t){var e=new t(this);this.children[e.name]=e},this.setParent=function(t){this.parent=t},this.clearParent=function(){this.parent=null},this.addChild=function(t,e){e.setParent?e.setParent(this):e.parent&&(e.parent=this),this.children[t]=e},this.insertChild=function(t){t.setParent?t.setParent(this):t.parent&&(t.parent=this),this.children[this.getChildName()]=t},this.delChild=function(t){return t in this.children&&(delete this.children[t],!0)},this.delComponent=function(t){return this.delChild("["+t+"]")},this.delComponentOfType=function(t){var e=this.getComponentOfType(t).name;return this.delChild(e)},this.getGlobalTransform=function(){return null==this.parent?this.transform:Transform.add(this.transform,this.parent.getGlobalTransform())},this.getDimentions=function(){var t=new Vector2d(0,0);for(var e in this.children)if(this.children.hasOwnProperty(e)&&this.children[e]){var n=this.children[e];if(n.getDimentions){var i=n.getDimentions();if(i.x=Math.max(i.x,0),i.y=Math.max(i.y,0),n.transform){var r=n.transform.pos.clone();i.x+=Math.abs(r.x),i.y+=Math.abs(r.y)}t.x=Math.max(t.x,i.x),t.y=Math.max(t.y,i.y)}}return t},this.setDimentions=function(t,e){for(var n in this.children)if(this.children.hasOwnProperty(n)&&this.children[n]){var i=this.children[n];i.setDimentions&&i.setDimentions(t,e)}},this.getChildName=function(){return this.name+"."+this.max_cid++},this.getEntityChildren=function(){for(var t=Object.values(this.children),e=[],n=0;n<t.length;n++)t[n]instanceof Entity&&e.push(t[n]);return e},this.init=function(){this.name=e,this.children={},this.transform=new Transform(i,r),this.game=t,this.auto_physics=s,this.auto_render=s,this.auto_update=s,this.alive=n,this.max_cid=0,this.parent=null},this.init()}function Game(t,e,n,i,r){this.init=function(){this.lastDelay=0,this.time=new Time(n),this.renderTime=new Time(n),this.interval=null,this.renderInterval=null,this.graphics=null,this.update=null,this.automated=!0,this.debugMode=!!r&&r,this.state="loading",this.inputManager=null,this.guiManager=null,this.resourceManager=new ResourceManager,this.assetManager=new AssetManager(i),this.sceneManager=new SceneManager(this)},this.init(),this.setup=function(){this.graphics=new Graphics(t,e),this.inputManager=new InputManager(this.graphics.canvas),this.guiManager=new GuiManager(this);var n=this;window.onerror=function(t,e,i,r,s){return n.debug&&n.warn(t+": "+s),!1}},this.start=function(t,e){"running"!=this.state&&(this.update=t,this.automated=e,this.state="running",this.time.isFixedTime()?this.interval=setInterval(this.handler.bind(this),1e3*this.time.getDeltaTime()):(this.updateLoop(),this.renderLoop()))},this.stop=function(){null!=this.interval&&clearInterval(this.interval),this.renderInterval&&cancelAnimationFrame(this.renderInterval)},this.handler=function(){this.time.update(),this.automated&&(this.sceneManager.update(),this.graphics.clear(),this.sceneManager.render()),this.update&&this.update()},this.updateLoop=function(){this.time.update(),this.automated&&this.sceneManager.update(),this.update&&this.update(),this.lastDelay=(this.lastDelay+this.time.getDeltaTime())/2,setTimeout(this.updateLoop.bind(this),this.lastDelay)},this.renderLoop=function(){this.renderTime.update(),this.graphics.clear(),this.sceneManager.render(),this.automated&&(this.renderInterval=requestAnimationFrame(this.renderLoop.bind(this),this.graphics.canvas))},this.getCurrentScene=function(){return this.sceneManager.getCurrentScene()},this.getCanvasWidth=function(){return null!=this.graphics?this.graphics.canvas.width:t},this.getCanvasHeight=function(){return null!=this.graphics?this.graphics.canvas.height:e},this.GetAnimSpeed=function(t){return t*this.time.getDeltaTime()},this.renderText=function(t,e,n,i,r){var s=this.graphics.context;r&&(s.font=r),i&&(s.fillStyle=i),s.fillText(n,t,e)},this.logAndStop=function(t){console.log(t),this.stop()},this.warn=function(t){this.guiManager.errorPopup(t)}}function Time(t){this.getTimeFromStart=function(){return Time.getTime()-this.startTime},this.getDeltaTime=function(){return this.dt},this.update=function(){if(!this.isFixedTime()){var t=Time.getTime();this.dt=(t-this.lastTime)/1e3,this.lastTime=t}},this.isFixedTime=function(){return this.fps&&this.fps>0},this.init=function(){this.startTime=Time.getTime(),this.lastTime=this.startTime,this.fps=t,this.dt=1/this.fps},this.init()}function Transform(t,e,n,i){t=t?t:0,e=e?e:0,n=n?n:1,i=i?i:1,this.pos=new Vector2d(t,e),this.scale=new Vector2d(n,i),this.angle=0}function Animation(t,e,n,i,r){this.spr=e,this.frame=new AnimFrame(0,0,n,i),this.frameCounter=0,this.setAnimationIndex=function(t){this.frame.setAnimationIndex(t,this.spr.image.height)},this.setFrameIndex=function(t){this.frame.setFrameIndex(t,this.spr.image.width)},this.nextAnimation=function(){this.frame.nextAnimation(this.spr.image.height)},this.nextFrame=function(){this.frame.nextFrame(this.spr.image.width)},this.updateFrame=function(){this.frameCounter=(this.frameCounter+1)%Math.floor(t.time.getDeltaTime()/r),0==this.frameCounter&&this.nextFrame()},this.render=function(){t.graphics.context.drawImage(this.spr.image,this.frame.px,this.frame.py,this.frame.w,this.frame.h,this.spr.width/-2,this.spr.height/-2,this.spr.width,this.spr.height)}}function AnimFrame(t,e,n,i){this.px=t,this.py=e,this.w=n,this.h=i,this.getAnimationIndex=function(){return this.px/this.w},this.getFrameIndex=function(){return this.py/this.h},this.setAnimationIndex=function(t,e){this.py=(this.py+this.h*t)%e},this.setFrameIndex=function(t,e){this.px=t*this.w%e},this.nextAnimation=function(t){this.py=(this.py+this.h)%t},this.nextFrame=function(t){this.px=(this.px+this.w)%t}}function AnimSprite(t,e,n,i,r,s,o){this.spr=new Sprite(t,e,n,i),this.anim=new Animation(t,this.spr,r,s,o),this.interval=null,this.startAnimation=function(){var t=this;null==this.interval?this.interval=setInterval(t.anim.nextFrame.bind(t.anim),1/o*1e3):console.warn("JSCF: [startAnimation] animation already started!")},this.stopAnimation=function(){this.interval&&(clearInterval(this.interval),this.interval=null)},this.updateAnim=function(){this.anim.updateFrame()},this.render=function(){this.anim.render()},this.staticRender=function(){this.spr.render()}}function Circle(t,e,n){this.radius=e,this.color=n,this.setDimentions=function(t,e){t>0&&(this.radius=t),e>0&&(this.radius=e)},this.getDimentions=function(){return new Vector2d(this.radius,this.radius)},this.render=function(){ctx=t.graphics.context,ctx.fillStyle=this.color,ctx.beginPath(),ctx.arc(0,0,this.radius,0,2*Math.PI),ctx.fill()}}function Effect(t,e){this.pre_render=t,this.post_render=e}function ShaderStart(t,e){this.render=function(){e.pre_render(t.graphics.context)}}function ShaderEnd(t,e){this.render=function(){e.post_render(t.graphics.context)}}function Graphics(t,e){this.init=function(){null==document.body&&alert("JSCF: Fatal error!\nCan't initialize graphics before body is loaded!"),this.canvas=document.createElement("canvas"),this.canvas.id="GameCanvas",t<0?this.canvas.width=window.innerWidth-50:this.canvas.width=t,e<0?this.canvas.height=window.innerHeight-50:this.canvas.height=e,this.context=this.canvas.getContext("2d"),document.body.insertBefore(this.canvas,document.body.childNodes[0])},this.init(),this.clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}}function Plane(t,e,n,i){this.width=e,this.height=n,this.color=i,this.effect=null,this.setDimentions=function(t,e){t>0&&(this.width=t),e>0&&(this.height=e)},this.getDimentions=function(){return new Vector2d(this.width,this.height)},this.render=function(){ctx=t.graphics.context,this.effect&&this.effect.pre_render(ctx),ctx.fillStyle=this.color,ctx.fillRect(this.width/-2,this.height/-2,this.width,this.height),this.effect&&this.effect.post_render(ctx)}}function Rectangle(t,e,n,i){this.width=e,this.height=n,this.color=i,this.setDimentions=function(t,e){t>0&&(this.width=t),e>0&&(this.height=e)},this.getDimentions=function(){return new Vector2d(this.width,this.height)},this.render=function(){ctx=t.graphics.context,ctx.strokeStyle=this.color,ctx.strokeRect(this.width/-2,this.height/-2,this.width,this.height)}}function Sprite(t,e,n,i){this.width=e,this.height=n,this.image=new Image,this.image.src=i,this.render=function(){t.graphics.context.drawImage(this.image,0,0,this.image.width,this.image.height,this.width/-2,this.height/-2,this.width,this.height)},this.setImageSrcFromAsset=function(e){this.image.src=t.assetManager.getAssetPath(e)}}function InputManager(t){function e(t){t.preventDefault(),u=t,d=!0}function n(t){t.preventDefault(),u=t,d=!1}function i(t){o[t.keyCode]=!0}function r(t){o[t.keyCode]=!1}function s(e){a=e.clientX-t.offsetLeft,h=e.clientY-t.offsetTop}var o=[],a=0,h=0,d=!1,u=-1;this.isKeyDownChar=function(t){return o[t.toUpperCase().charCodeAt()]},this.isKeyDown=function(t){return o[t]},this.getMouseX=function(){return a},this.getMouseY=function(){return h},this.isMouseDown=function(){return d},this.isLMBDown=function(){return d&&0==u.button},this.isRMBDown=function(){return d&&2==u.button},this.getMouseEvent=function(){return u},this.setOnMouseUp=function(t){document.addEventListener("mouseup",t)},this.setOnMouseDown=function(t){document.addEventListener("mousedown",t)},this.setOnKeyUp=function(t){document.addEventListener("keyup",t)},this.setOnKeyUpSpec=function(t,e){this.setOnKeyUp(function(n){n.keyCode==t&&e()})},document.addEventListener("keydown",i),document.addEventListener("keyup",r),document.addEventListener("mousemove",s),document.addEventListener("contextmenu",function(){event.preventDefault()}),this.setOnMouseDown(e),this.setOnMouseUp(n)}function Manifold(t,e){this.rigidBody1=t.getBuiltinComponent("rigidbody"),this.rigidBody2=e.getBuiltinComponent("rigidbody"),this.collider1=t.getBuiltinComponent("collider"),this.collider2=e.getBuiltinComponent("collider"),this.valid=this.rigidBody1&&this.rigidBody2&&this.collider1&&this.collider2,this.getPenetration=function(){return this.collider1.resolver.getPenetration(this.collider2.resolver)},this.getNormal=function(){return this.collider1.getNormal(this.collider2)}}function PhysicsEngine(t){this.pixelMeterRatio=50,this.numIterations=5,this.tickDuration=1/this.numIterations,this.gravity=new Vector2d(0,9.8*this.pixelMeterRatio),"undefined"==typeof Rigidbody&&(console.warn("[JSCF][PhysicsEngine] Rigidbody component not included! Disabled!"),this.numIterations=0),this.applyNaturalForces=function(t){t.auto_gravity&&!t.static&&t.applyAcceleration(this.gravity)},this.applyCollision=function(t){if(t.valid){var e=t.getNormal();t.rigidBody1.calcCollision(t.rigidBody2,e)}},this.fixPenetration=function(t){if(t.valid){var e=t.getPenetration();t.rigidBody1.fixPenetration(t.rigidBody2,e)}},this.detectCollisions=function(){var e={},n=[];for(entityName in t)if(t.hasOwnProperty(entityName)){var i=t[entityName];if(!i)continue;if(i.auto_physics){var r=i.getComponentOfType(Rigidbody);if(!r)continue;r.tick_update(this.tickDuration);var s=i.getComponentOfType(Collider);if(!s||!s.others)continue;s.update();for(var o=0;o<s.others.length;o++){var a=s.others[o];if(a){if(e[i.name]&&e[i.name][a.name])break;e[a.name]||(e[a.name]={}),e[a.name][i.name]=!0;var h=new Manifold(i,a);n.push(h)}}}}return n},this.resolveNaturalForces=function(){for(entityName in t)if(t.hasOwnProperty(entityName)){var e=t[entityName];if(!e)continue;if(e.auto_physics){var n=e.getComponentOfType(Rigidbody);if(!n)continue;this.applyNaturalForces(n)}}},this.resolveCollisions=function(t){for(var e=0;e<t.length;e++)this.applyCollision(t[e]);for(var e=0;e<t.length;e++)this.fixPenetration(t[e])},this.update=function(t){this.tickDuration=t/this.numIterations;for(var e=0;e<this.numIterations;e++){this.resolveNaturalForces();var n=this.detectCollisions();this.resolveCollisions(n)}}}function AssetManager(t){this.rules={},this.getExtention=function(t){return t.substring(t.lastIndexOf("."),t.length)},this.getAssetPath=function(e){return t+"\\"+e},this.getAssetDir=function(){return t},this.getRule=function(t){return this.rules[t]},this.setRule=function(t,e){this.rules[t]=e}}function _clone(t){if(!t)return t;var e,n=[Number,String,Boolean];if(n.forEach(function(n){t instanceof n&&(e=n(t))}),"undefined"==typeof e)if("[object Array]"===Object.prototype.toString.call(t))e=[],t.forEach(function(t,n,i){e[n]=clone(t)});else if("object"==typeof t)if(t.nodeType&&"function"==typeof t.cloneNode)var e=t.cloneNode(!0);else if(t.prototype)e=t;else if(t instanceof Date)e=new Date(t);else{e={};for(var i in t)e[i]=_clone(t[i])}else e=t;return e}function ResourceManager(){this.resources={},this.getResourceName=function(t){for(var e=0,n=this.resources.length;e<n;e++)if(t==this.resources.data[e])return this.resources.data[e].name},this.get=function(t){return t&&this.resources[t]?this.resources[t]:(console.warn("[JSCF] resrouce manager get() - got invalid key."),null)},this.getClone=function(t){var e=this.get(t),n=_clone(e);return n.game&&(n.game=e.game),this.add(t+"_clone",n)?n:e},this.add=function(t,e){return t?this.resources[t]?(console.warn("[JSCF] resource manager set() - resource already exists!"),!1):(this.resources[t]=e,!0):(console.warn("[JSCF] resource manager set() - got invalid key."),!1)},this.remove=function(t){return t&&this.resources[t]?(this.resources[t]=null,!0):(console.warn("[JSCF] resrouce manager remove() - got invalid key."),null)},this.removeByValue=function(t){var e=this.getResourceName(t);return!!e&&this.remove(e)}}function Scene(t){this.max_euid=0,this.entities={},this.paused=!1,this.physicsEngine=new PhysicsEngine(this.entities),this.pause=function(){this.paused=!0},this.resume=function(){this.paused=!1},this.update=function(){if(this.paused)return!1;for(entityName in this.entities)if(this.entities.hasOwnProperty(entityName)){var e=this.entities[entityName];if(!e)continue;e.update&&e.auto_update&&e.update()}return this.physicsEngine.update(t.time.getDeltaTime()),!0},this.render=function(){if(this.paused)return!1;for(entityName in this.entities)if(this.entities.hasOwnProperty(entityName)){var t=this.entities[entityName];t&&t.auto_render&&t.render()}return!0},this.getEntity=function(t){var e=this.entities[t];if(e)return e;for(var n in this.entities)if(this.entities.hasOwnProperty(n)&&this.entities[n].getChild){var i=this.entities[n].getChild(t);if(i)return i}console.warn("[JSCF] scene couldn't find requested object: "+t)},this.addEntity=function(t){return!(t.name in this.entities)&&(this.entities[t.name]=t,t)},this.delEntity=function(t){return t in this.entities&&(delete this.entities[t],!0)},this.createManualEntity=function(e,n,i,r){var s=new Entity(t,e,!0,n,i,!1);return s.addChild(this.getChildName(s,r),r),this.addEntity(s)},this.createEntity=function(e,n,i,r){var s=new Entity(t,e,!0,n,i,!0);return s.addChild(this.getChildName(s,r),r),this.addEntity(s)},this.createNewEntity=function(e){var n=new Entity(t,this.getEntityName(),!0,0,0,!0);return n.addChild(this.getChildName(n,e),e),this.addEntity(n)},this.getChildName=function(t,e){return e.name?e.name:t.getChildName()},this.getEntityName=function(){return this.max_euid++,"entity_"+this.max_euid}}function SceneManager(t){this.scenes={splash:new Scene(t)},this.cur_scene=this.scenes.splash,this.update=function(){return this.cur_scene.update()},this.render=function(){return this.cur_scene.render()},this.getCurrentScene=function(){return this.cur_scene},this.setCurrentScene=function(t){return t&&this.scenes[t]?(this.cur_scene=this.scenes[t],!0):(console.warn("[JSCF] tried to change into an invalid scene!"),!1)},this.createScene=function(e){return e?this.scenes[e]?(console.warn("[JSCF] scene "+e+" already exists (scene creation)!"),!1):(this.scenes[e]=new Scene(t),!0):(console.warn("[JSCF] got an invalid scene name in creation!"),!1)},this.deleteScene=function(t){return t?!!this.scenes[t]||(console.warn("[JSCF] scene "+t+" doesn't exists (scene creation)!"),!1):(console.warn("[JSCF] got an invalid scene name in deletion!"),!1)}}function SoundPlayer(t){this.sound=document.createElement("audio"),this.sound.style.display="none",this.sound.src=t,this.sound.setAttribute("preload","auto"),this.sound.setAttribute("controls","none"),document.body.appendChild(this.sound),this.play=function(){this.sound.play()},this.stop=function(){this.sound.pause()}}function GuiManager(t){this.eleNum=0,this.isDebug=!1;var e=t.graphics.context.createLinearGradient(0,20,0,0);e.addColorStop(0,"#bebebe"),e.addColorStop(1,"#e7e7e7"),this.createContainer=function(e,n,i,r,s,o){var a=new Entity(t,e,!0,n,i,!0),h=new Plane(t,r,s,o);return h.effect=shadowFx,a.addChild(__GUIMANAGER_BG_NAME,h),a},this.createDefaultContainer=function(t,e){return this.createContainer("con"+this.eleNum,t,e,__GUIMANAGER_CONTAINER_WIDTH,__GUIMANAGER_CONTAINER_HEIGHT,__GUIMANAGER_CONTAINER_COLOR)},this.createButton=function(e,n,i,r,s,o,a,h,d){var u=this.createContainer(e,n,i,r,s,o),c=(u.getChildAt(0),new Text(t,a,h,d));return u.addChild(__GUIMANAGER_TXT_NAME,c),"undefined"==typeof ButtonHandler?console.warn("[JSCF][GuiManager] ButtonHandler component not loaded! Some functionality is disabled!"):u.addComponent(ButtonHandler),u},this.createDefaultButton=function(t,n,i){return this.createButton("btn"+this.eleNum++,t,n,__GUIMANAGER_BUTTON_WIDTH,__GUIMANAGER_BUTTON_HEIGHT,e,i,__GUIMANAGER_BUTTON_FONT_COLOR,__GUIMANAGER_BUTTON_FONT)},this.createTextBox=function(e,n,i,r,s,o){var a=new Entity(t,e,!0,n,i,!0);return a.insertChild(new Textbox(a,r,s,o)),a},this.createDefaultTextBox=function(t,e){return this.createTextBox("tb"+this.eleNum,t,e,__GUIMANAGER_TXTBOX_WIDTH,__GUIMANAGER_TXTBOX_HEIGHT)},this.createLabel=function(e,n,i){var r=new Text(t,i,"white","15px arial");r.enabled=!0;var s=new Entity(t,"txt",!0,e,n,!0);return s.insertChild(r),s},this.createDefaultWindow=function(e,n){var i=this.createDefaultContainer(e,n);i.name=__GUIMANAGER_WINDOW_NAME+this.eleNum++;var r=this.createDefaultButton((__GUIMANAGER_BUTTON_WIDTH-i.getChild("bg").width)/2,(__GUIMANAGER_BUTTON_HEIGHT-i.getChild("bg").height)/2,"X");return r.name=i.name+"-x-btn",r.setDimentions=function(){r.transform.pos.x=(__GUIMANAGER_BUTTON_WIDTH-i.getChild("bg").width)/2,r.transform.pos.y=(__GUIMANAGER_BUTTON_HEIGHT-i.getChild("bg").height)/2},r.getComponentOfType(ButtonHandler).onClick=function(){console.log(i.parent),null==i.parent?t.getCurrentScene().delEntity(i.name):r.parent.delChild(i.name)},i.insertChild(r),i},this.createRectEditor=function(e,n,i){var r=new Entity(t,"rect-editor",!0,e,n,!0);return r.insertChild(new RectangleEditor(r,i)),r},this.createDebugPanel=function(){var e=this,n=t.getCanvasHeight(),i=t.getCanvasWidth()/4,r=t.guiManager.createDefaultButton(0,0,"Toggle");r.getComponentOfType(ButtonHandler).onClick=function(){var t=l.getChildAt(0);t.enabled=!t.enabled};var s=t.guiManager.createDefaultButton(0,0,"Help Panel");s.getComponentOfType(ButtonHandler).onClick=function(){var n=e.createHelpPanel();n.addComponent(RectangleEditor),t.getCurrentScene().addEntity(n)};var o=t.guiManager.createDefaultTextBox(0,0),a=o.getChildAt(0).textBox;a.placeHolder("Search entity..."),a.onsubmit(function(){var e=t.getCurrentScene().getEntity(a.value());if(!e)return void a.value("");var n=e.transform.pos;h.getChildAt(0).textBox.value(n.x),d.getChildAt(0).textBox.value(n.y)});var h=t.guiManager.createDefaultTextBox(0,0);h.getChildAt(0).textBox.placeHolder("pos.x"),h.getChildAt(0).textBox.onsubmit(function(){var e=t.getCurrentScene().getEntity(a.value());return e?void(e.transform.pos.x=parseInt(h.getChildAt(0).textBox.value())):void a.value("")});var d=t.guiManager.createDefaultTextBox(0,0);d.getChildAt(0).textBox.placeHolder("pos.y"),d.getChildAt(0).textBox.onsubmit(function(){var e=t.getCurrentScene().getEntity(a.value());return e?void(e.transform.pos.y=parseInt(d.getChildAt(0).textBox.value())):void a.value("")});var u=this.createLabel(0,0,""),c=this.createLabel(0,0,"Transform"),l=this.createLabel(0,0,""),f={lastTime:performance.now(),update:function(){var n=performance.now();if(n-f.lastTime>1e3){f.lastTime=n;const i="\n";var r=l.getChildAt(0);if(r.enabled){for(var s=Object.keys(t.getCurrentScene().entities),o="",a=0;a<s.length;a++)o+=e.buildString(t.getCurrentScene().getEntity(s[a]))+i;r.setText(o)}else r.setText("");var h=u.getChildAt(0),d=Math.max(t.time.getDeltaTime(),t.renderTime.getDeltaTime());h.setText(parseInt(1/d).toString()+" fps")}}},_=t.guiManager.createContainer(__GUIMANAGER_DEBUG_PANEL_NAME,i/2,n/2,i,n,__GUIMANAGER_CONTAINER_COLOR);return _.addComponent(LayoutHandler),_.getComponentOfType(LayoutHandler).layoutType=LinedLayout,_.insertChild(u),_.insertChild(o),_.insertChild(c),_.insertChild(h),_.insertChild(d),_.insertChild(s),_.insertChild(r),_.insertChild(l),_.insertChild(f),_},this.errorPopup=function(e){var n=this.createDefaultWindow(t.getCanvasWidth()/2,t.getCanvasHeight()/2);n.insertChild(this.createLabel(0,0,e)),t.getCurrentScene().addEntity(n)},this.createHelpPanel=function(){const e="Welcome to the JSCF editor!\n- Use left-click to drag entities\n- Use right-click to resize\n- Use ~ button to toggle",n=t.getCanvasWidth()/4+50;var i=this.createDefaultWindow(n,t.getCanvasWidth()/4);return i.name=__GUIMANAGER_HELP_PANEL_NAME+this.eleNum++,i.insertChild(this.createLabel(0,0,e)),i},this.insertDebugPanel=function(){var e=this.createDebugPanel(),n=this.createHelpPanel();t.getCurrentScene().addEntity(e),t.getCurrentScene().addEntity(n)},this.insertRectangleEditor=function(){var e=t.getCurrentScene().entities;for(var n in e)e.hasOwnProperty(n)&&e[n].name!=__GUIMANAGER_DEBUG_PANEL_NAME&&e[n].addComponent(RectangleEditor)},this.delRectangleEditor=function(){var e=t.getCurrentScene().entities;for(var n in e)e.hasOwnProperty(n)&&e[n].name!=__GUIMANAGER_DEBUG_PANEL_NAME&&e[n].delComponentOfType(RectangleEditor)},this.toggleDebugPanel=function(){var e=t.getCurrentScene();this.isDebug=!this.isDebug,this.isDebug?(this.insertDebugPanel(),this.insertRectangleEditor()):(this.delRectangleEditor(),e.delEntity(__GUIMANAGER_DEBUG_PANEL_NAME))},this.buildString=function(t){var e="";e+=t.name+" (Entity)";for(var n in t.children)if(t.children.hasOwnProperty(n)){e+="\n\t\t\t";var i=t.children[n];e+=i instanceof Entity?this.buildString(i):i.constructor.component_name?"\t\t\t- "+i.constructor.component_name+" (Component)":"\t\t\t- "+n+" ("+i.constructor.name+")"}return e},this.init=function(){if(t.debugMode){var e=this;t.inputManager.setOnKeyUpSpec(192,e.toggleDebugPanel.bind(e))}},this.init()}function Text(t,e,n,i){this.txt="",this.style=n,this.font=i,this.lines=[],this.maxWidth=0,this.maxHeight=20,this.lineMargin=5,this.setText=function(e){this.txt=e,this.lines=String(this.txt).split("\n");var n=t.graphics.context;n.font=this.font;for(var i=0;i<this.lines.length;i++){var r=n.measureText(this.lines[i]).width;this.maxWidth=Math.max(this.maxWidth,r)}this.maxHeight=parseInt(n.font.match(/\d+/),10)+this.lineMargin},this.getDimentions=function(){return new Vector2d(this.maxWidth,this.maxHeight)},this.setDimentions=function(t,e){},this.render=function(){for(var e=this.getDimentions(),n=0;n<this.lines.length;n++)t.renderText(-e.x/2,n*e.y,this.lines[n],this.style,this.font)},this.init=function(){this.setText(e)},this.init()}function Textbox(t,e,n,i){const r=.8,s=.97,o=.5;this.parent=t,this.textBox=new CanvasInput({canvas:t.game.graphics.canvas,width:e,height:n,value:i?i:"",fontSize:n*r,borderRadius:0,innerShadow:"0px 0px 0px #fff",borderColor:"#000",boxShadow:"0px 0px 0px #fff"}),this.setDimentions=function(t,e){t>0&&this.textBox.width(t*s),e>0&&this.textBox.height(e*o)},this.getDimentions=function(){return new Vector2d(this.textBox.width()/s,this.textBox.height()/o)},this.setDimentions=function(t,e){t>0&&this.textBox.width(t*s),e>0&&this.textBox.height(e*o)},this.getDimentions=function(){return new Vector2d(this.textBox.width()/s,this.textBox.height()/o)},this.update=function(){this.parent.transform||console.warn("[JSCF][Textbox] No transform! Parent isn't entity?");var t=this.parent.getGlobalTransform(),e=this.getDimentions(),n=Math.round(t.pos.x-e.x/2),i=Math.round(t.pos.y-e.y/2);this.textBox.x(n),this.textBox.y(i)},this.render=function(){var t=this.parent.game.graphics.context;shadowFx.pre_render(t),t.save(),t.setTransform(1,0,0,1,0,0);var e=this.textBox.render(!0);return t.restore(),shadowFx.post_render(t),e}}function Point2d(t,e){this.vec=new Vector2d(t,e),this.distanceTo=function(t){return Vector.subVector(this.vec,t.vec).length()},this.setX=function(t){this.vec.x=t},this.setY=function(t){this.vec.y=t},this.getX=function(){return this.vec.x},this.getY=function(){return this.vec.y}}function Vector2d(t,e){this.x=t?t:0,this.y=e?e:0,this.add=function(t,e){return this.x+=t,this.y+=e,this},this.sub=function(t,e){return this.add(-t,-e)},this.scalarAdd=function(t){return this.add(t,t)},this.scalarSub=function(t){return this.sub(t,t)},this.scalarMul=function(t){this.x*=t,this.y*=t},this.scalarDiv=function(t){0!=t&&(this.x/=t,this.y/=t)},this.addVector=function(t){return this.add(t.x,t.y)},this.subVector=function(t){return this.sub(t.x,t.y)},this.dotProduct=function(t){return this.x*t.x+this.y*t.y},this.length=function(){return Math.sqrt(MathUtils.square(this.x)+MathUtils.square(this.y))},this.getNormal=function(){var t=this.length();return 0!=t?new Vector2d(this.x/t,this.y/t):new Vector2d(0,0)},this.normalize=function(){var t=this.length();return t?(this.x/=t,void(this.y/=t)):(this.x=0,void(this.y=0))},this.makeArray=function(){return[this.x,this.y]},this.clone=function(){return new Vector2d(this.x,this.y)}}const __BUTTON_HANDLER_NAME="[builtin_button_handler]",__BUTTON_HANDLER_HOVER_SPEED=1.1,__BUTTON_HANDLER_HOVER_MAX=1.5;ButtonHandler.component_name=__BUTTON_HANDLER_NAME;const __COLLIDER_NAME="[builtin_collider]";var Collider=function(t,e,n){this.getNormal=function(t){return this.resolver.getNormal(t.resolver)},this.update=function(){this.resolver.setTransform(this.parent.getGlobalTransform()),this.others=[],null==this.potential_entities&&(this.potential_entities=this.parent.game.getCurrentScene().entities);for(entityName in this.potential_entities)if(this.parent.name!=entityName&&this.potential_entities.hasOwnProperty(entityName)){var t=this.potential_entities[entityName];if(!t)continue;var e=t.getChild(this.name);e&&this.resolver.isColliding(e.resolver)&&this.others.push(t)}this.potential_entities=null},this.init=function(){if(this.name=__COLLIDER_NAME,this.parent=t,this.normal=new Vector2d(0,0),this.others=[],n?this.potential_entities=n:this.potential_entities=null,e)this.resolver=e;else{var i=this.parent.getGlobalTransform().pos,r=this.parent.getDimentions();this.resolver=new AABB(i.x,i.y,r.x,r.y)}},this.init();
};Collider.component_name=__COLLIDER_NAME;const __LAYOUT_COMPONENT_NAME="[builtin_layout_handler]";var LayoutHandler=function(t){this.layoutType=Layout,this.name=__LAYOUT_COMPONENT_NAME,this.parent=t,this.init=function(){},this.update=function(){this.layoutType.doLayout(this.parent),this.update=null}};LayoutHandler.component_name=__LAYOUT_COMPONENT_NAME;const __RECTANGLE_EDITOR_NAME="[rectangle_editor]",__RECTANGLE_DEFAULT_ACTIVE_STYLE="red",__RECTANGLE_DEFAULT_PASSIVE_STYLE="black";RectangleEditor.currently_selected=null,RectangleEditor.component_name=__RECTANGLE_EDITOR_NAME;const __RIGIDBODY_NAME="[builtin_rigidbody]",__RIGIDBODY_BIAS=1e4,__RIGIDBODY_EPSILON=__RIGIDBODY_BIAS/Number.MAX_VALUE,__RIGIDBODY_STAIC_MASS=1/__RIGIDBODY_EPSILON;var Rigidbody=function(t){this.setParent=function(t){this.parent=t},this.setStaticBody=function(){this.static=!0,this.auto_gravity=!1,this.mass=__RIGIDBODY_STAIC_MASS},this.update=function(t){this.auto_update&&this.tick_update(t)},this.tick_update=function(t){this.tickDuration=t,this.parent.transform.pos.x+=this.velocity.x*this.tickDuration,this.parent.transform.pos.y+=this.velocity.y*this.tickDuration},this.calcCollision=function(t,e){const n=this.mass,i=t.mass,r=(this.cor+t.cor)/2,s=new Vector2d(-e.y,e.x),o=this.velocity,a=t.velocity;var h=o.dotProduct(e),d=s.dotProduct(o),u=e.dotProduct(a),c=s.dotProduct(a),l=d,f=c,_=(h*(n-r*i)+(1+r)*i*u)/(n+i),p=(u*(i-r*n)+(1+r)*n*h)/(n+i),g=new Vector2d(_*e.x,_*e.y),m=new Vector2d(l*s.x,l*s.y),v=new Vector2d(p*e.x,p*e.y),y=new Vector2d(f*s.x,f*s.y),x=new Vector2d(g.x+m.x,g.y+m.y),w=new Vector2d(v.x+y.x,v.y+y.y);this.static||(this.velocity=x),t.static||(t.velocity=w)},this.fixPenetration=function(t,e){e.clone();this.static||this.parent.transform.pos.addVector(e),t.static||t.parent.transform.pos.subVector(e)},this.applyAcceleration=function(t){var e=t.clone();e.scalarMul(this.tickDuration),this.applyVelocity(e)},this.applyVelocity=function(t){this.velocity.addVector(t)},this.init=function(){this.name=__RIGIDBODY_NAME,this.parent=t,this.tickDuration=0,this.displacement=new Vector2d(0,0),this.velocity=new Vector2d(0,0),this.ro=1,this.cor=1,this.mass=this.parent.transform.scale.x*this.parent.transform.scale.y*this.ro,this.auto_gravity=!0,this.auto_update=!1,this.static=!1,this.parent.hasComponentOfType(Collider)||console.error("[jscf/components/rigidbody] parent doesn't have collider."),this.parent.transform||console.error("[jscf/components/rigidbody] parent doesn't have transform! Not an entity?")},this.init()};Rigidbody.component_name=__RIGIDBODY_NAME;const __SCRIPT_COMPONENT_NAME="[builtin_script]";var Script=function(t){this.name=__COMPONENT_NAME,this.parent=t,this.init=function(){},this.update=function(){}};Script.component_name=__SCRIPT_COMPONENT_NAME;const __COMPONENT_NAME="[builtin_component]";var Component=function(t){this.parent=t,this.name=__COMPONENT_NAME,this.init=function(){},this.update=function(){}};Component.component_name=__COMPONENT_NAME,Component.typeToName=function(t){var e=t.component_name;return e||(e=t.name.toLowerCase()),e},Time.getTime=function(){return performance.now()},Transform.add=function(e,n){return t=new Transform,t.pos=Vector.addVector(e.pos,n.pos),t.scale=new Vector2d(e.scale.x*n.scale.x,e.scale.y*n.scale.y),t.angle=e.angle+n.angle,t};var shadowFx=new Effect(function(t){t.shadowBlur=10,t.shadowColor="black"},function(t){t.shadowBlur=0,t.shadowColor="transparent"}),SceneUtils={makeFloor:function(t,e,n,i,r,s){var o=[];return o}};!function(){var t=[],e=window.CanvasInput=function(e){var n=this;e=e?e:{},n._canvas=e.canvas||null,n._ctx=n._canvas?n._canvas.getContext("2d"):null,n._x=e.x||0,n._y=e.y||0,n._extraX=e.extraX||0,n._extraY=e.extraY||0,n._fontSize=e.fontSize||14,n._fontFamily=e.fontFamily||"Arial",n._fontColor=e.fontColor||"#000",n._placeHolderColor=e.placeHolderColor||"#bfbebd",n._fontWeight=e.fontWeight||"normal",n._fontStyle=e.fontStyle||"normal",n._fontShadowColor=e.fontShadowColor||"",n._fontShadowBlur=e.fontShadowBlur||0,n._fontShadowOffsetX=e.fontShadowOffsetX||0,n._fontShadowOffsetY=e.fontShadowOffsetY||0,n._readonly=e.readonly||!1,n._maxlength=e.maxlength||null,n._width=e.width||150,n._height=e.height||n._fontSize,n._padding=e.padding>=0?e.padding:5,n._borderWidth=e.borderWidth>=0?e.borderWidth:1,n._borderColor=e.borderColor||"#959595",n._borderRadius=e.borderRadius>=0?e.borderRadius:3,n._backgroundImage=e.backgroundImage||"",n._boxShadow=e.boxShadow||"1px 1px 0px rgba(255, 255, 255, 1)",n._innerShadow=e.innerShadow||"0px 0px 4px rgba(0, 0, 0, 0.4)",n._selectionColor=e.selectionColor||"rgba(179, 212, 253, 0.8)",n._placeHolder=e.placeHolder||"",n._value=(e.value||n._placeHolder)+"",n._onsubmit=e.onsubmit||function(){},n._onkeydown=e.onkeydown||function(){},n._onkeyup=e.onkeyup||function(){},n._onfocus=e.onfocus||function(){},n._onblur=e.onblur||function(){},n._cursor=!1,n._cursorPos=0,n._hasFocus=!1,n._selection=[0,0],n._wasOver=!1,n.manual=!0,n.boxShadow(n._boxShadow,!0),n._calcWH(),n._renderCanvas=document.createElement("canvas"),n._renderCanvas.setAttribute("width",n.outerW),n._renderCanvas.setAttribute("height",n.outerH),n._renderCtx=n._renderCanvas.getContext("2d"),n._shadowCanvas=document.createElement("canvas"),n._shadowCanvas.setAttribute("width",n._width+2*n._padding),n._shadowCanvas.setAttribute("height",n._height+2*n._padding),n._shadowCtx=n._shadowCanvas.getContext("2d"),"undefined"!=typeof e.backgroundGradient?(n._backgroundColor=n._renderCtx.createLinearGradient(0,0,0,n.outerH),n._backgroundColor.addColorStop(0,e.backgroundGradient[0]),n._backgroundColor.addColorStop(1,e.backgroundGradient[1])):n._backgroundColor=e.backgroundColor||"#fff",n._canvas&&(n._canvas.addEventListener("mousemove",function(t){t=t||window.event,n.mousemove(t,n)},!1),n._canvas.addEventListener("mousedown",function(t){t=t||window.event,n.mousedown(t,n)},!1),n._canvas.addEventListener("mouseup",function(t){t=t||window.event,n.mouseup(t,n)},!1));var i=function(t){t=t||window.event,n._hasFocus&&!n._mouseDown&&n.blur()};window.addEventListener("mouseup",i,!0),window.addEventListener("touchend",i,!0),n._hiddenInput=document.createElement("input"),n._hiddenInput.type="text",n._hiddenInput.style.position="absolute",n._hiddenInput.style.opacity=0,n._hiddenInput.style.pointerEvents="none",n._hiddenInput.style.zIndex=0,n._hiddenInput.style.transform="scale(0)",n._updateHiddenInput(),n._maxlength&&(n._hiddenInput.maxLength=n._maxlength),document.body.appendChild(n._hiddenInput),n._hiddenInput.value=n._value,n._hiddenInput.addEventListener("keydown",function(t){t=t||window.event,n._hasFocus&&(window.focus(),n._hiddenInput.focus(),n.keydown(t,n))}),n._hiddenInput.addEventListener("keyup",function(t){t=t||window.event,n._value=n._hiddenInput.value,n._cursorPos=n._hiddenInput.selectionStart,n._selection=[n._hiddenInput.selectionStart,n._hiddenInput.selectionEnd],n.render(),n._hasFocus&&n._onkeyup(t,n)}),t.push(n),n._inputsIndex=t.length-1,n.render()};e.prototype={canvas:function(t){var e=this;return"undefined"!=typeof t?(e._canvas=t,e._ctx=e._canvas.getContext("2d"),e.render()):e._canvas},x:function(t){var e=this;return"undefined"!=typeof t?(e._x=t,e._updateHiddenInput(),e.render()):e._x},y:function(t){var e=this;return"undefined"!=typeof t?(e._y=t,e._updateHiddenInput(),e.render()):e._y},extraX:function(t){var e=this;return"undefined"!=typeof t?(e._extraX=t,e._updateHiddenInput(),e.render()):e._extraX},extraY:function(t){var e=this;return"undefined"!=typeof t?(e._extraY=t,e._updateHiddenInput(),e.render()):e._extraY},fontSize:function(t){var e=this;return"undefined"!=typeof t?(e._fontSize=t,e.render()):e._fontSize},fontFamily:function(t){var e=this;return"undefined"!=typeof t?(e._fontFamily=t,e.render()):e._fontFamily},fontColor:function(t){var e=this;return"undefined"!=typeof t?(e._fontColor=t,e.render()):e._fontColor},placeHolderColor:function(t){var e=this;return"undefined"!=typeof t?(e._placeHolderColor=t,e.render()):e._placeHolderColor},fontWeight:function(t){var e=this;return"undefined"!=typeof t?(e._fontWeight=t,e.render()):e._fontWeight},fontStyle:function(t){var e=this;return"undefined"!=typeof t?(e._fontStyle=t,e.render()):e._fontStyle},fontShadowColor:function(t){var e=this;return"undefined"!=typeof t?(e._fontShadowColor=t,e.render()):e._fontShadowColor},fontShadowBlur:function(t){var e=this;return"undefined"!=typeof t?(e._fontShadowBlur=t,e.render()):e._fontShadowBlur},fontShadowOffsetX:function(t){var e=this;return"undefined"!=typeof t?(e._fontShadowOffsetX=t,e.render()):e._fontShadowOffsetX},fontShadowOffsetY:function(t){var e=this;return"undefined"!=typeof t?(e._fontShadowOffsetY=t,e.render()):e._fontShadowOffsetY},width:function(t){var e=this;return"undefined"!=typeof t?(e._width=t,e._calcWH(),e._updateCanvasWH(),e._updateHiddenInput(),e.render()):e._width},height:function(t){var e=this;return"undefined"!=typeof t?(e._height=t,e._calcWH(),e._updateCanvasWH(),e._updateHiddenInput(),e.render()):e._height},padding:function(t){var e=this;return"undefined"!=typeof t?(e._padding=t,e._calcWH(),e._updateCanvasWH(),e.render()):e._padding},borderWidth:function(t){var e=this;return"undefined"!=typeof t?(e._borderWidth=t,e._calcWH(),e._updateCanvasWH(),e.render()):e._borderWidth},borderColor:function(t){var e=this;return"undefined"!=typeof t?(e._borderColor=t,e.render()):e._borderColor},borderRadius:function(t){var e=this;return"undefined"!=typeof t?(e._borderRadius=t,e.render()):e._borderRadius},backgroundColor:function(t){var e=this;return"undefined"!=typeof t?(e._backgroundColor=t,e.render()):e._backgroundColor},backgroundGradient:function(t){var e=this;return"undefined"!=typeof t?(e._backgroundColor=e._renderCtx.createLinearGradient(0,0,0,e.outerH),e._backgroundColor.addColorStop(0,t[0]),e._backgroundColor.addColorStop(1,t[1]),e.render()):e._backgroundColor},boxShadow:function(t,e){var n=this;if("undefined"==typeof t)return n._boxShadow;var i=t.split("px ");return n._boxShadow={x:"none"===n._boxShadow?0:parseInt(i[0],10),y:"none"===n._boxShadow?0:parseInt(i[1],10),blur:"none"===n._boxShadow?0:parseInt(i[2],10),color:"none"===n._boxShadow?"":i[3]},n._boxShadow.x<0?(n.shadowL=Math.abs(n._boxShadow.x)+n._boxShadow.blur,n.shadowR=n._boxShadow.blur+n._boxShadow.x):(n.shadowL=Math.abs(n._boxShadow.blur-n._boxShadow.x),n.shadowR=n._boxShadow.blur+n._boxShadow.x),n._boxShadow.y<0?(n.shadowT=Math.abs(n._boxShadow.y)+n._boxShadow.blur,n.shadowB=n._boxShadow.blur+n._boxShadow.y):(n.shadowT=Math.abs(n._boxShadow.blur-n._boxShadow.y),n.shadowB=n._boxShadow.blur+n._boxShadow.y),n.shadowW=n.shadowL+n.shadowR,n.shadowH=n.shadowT+n.shadowB,n._calcWH(),e?void 0:(n._updateCanvasWH(),n.render())},innerShadow:function(t){var e=this;return"undefined"!=typeof t?(e._innerShadow=t,e.render()):e._innerShadow},selectionColor:function(t){var e=this;return"undefined"!=typeof t?(e._selectionColor=t,e.render()):e._selectionColor},placeHolder:function(t){var e=this;return"undefined"!=typeof t?(e._placeHolder=t,e.render()):e._placeHolder},value:function(t){var e=this;return"undefined"!=typeof t?(e._value=t+"",e._hiddenInput.value=t+"",e._cursorPos=e._clipText().length,e.render(),e):e._value===e._placeHolder?"":e._value},onsubmit:function(t){var e=this;return"undefined"!=typeof t?(e._onsubmit=t,e):void e._onsubmit()},onkeydown:function(t){var e=this;return"undefined"!=typeof t?(e._onkeydown=t,e):void e._onkeydown()},onkeyup:function(t){var e=this;return"undefined"!=typeof t?(e._onkeyup=t,e):void e._onkeyup()},focus:function(e){var n=this;if(!n._hasFocus){n._onfocus(n);for(var i=0;i<t.length;i++)t[i]._hasFocus&&t[i].blur()}n._selectionUpdated?delete n._selectionUpdated:n._selection=[0,0],n._hasFocus=!0,n._readonly?n._hiddenInput.readOnly=!0:(n._hiddenInput.readOnly=!1,n._cursorPos="number"==typeof e?e:n._clipText().length,n._placeHolder===n._value&&(n._value="",n._hiddenInput.value=""),n._cursor=!0,n._cursorInterval&&clearInterval(n._cursorInterval),n._cursorInterval=setInterval(function(){n._cursor=!n._cursor,n.render()},500));var r=n._selection[0]>0||n._selection[1]>0;return n._hiddenInput.focus(),n._hiddenInput.selectionStart=r?n._selection[0]:n._cursorPos,n._hiddenInput.selectionEnd=r?n._selection[1]:n._cursorPos,n.render()},blur:function(t){var e=t||this;return e._onblur(e),e._cursorInterval&&clearInterval(e._cursorInterval),e._hasFocus=!1,e._cursor=!1,e._selection=[0,0],e._hiddenInput.blur(),""===e._value&&(e._value=e._placeHolder),e.render()},keydown:function(e,n){var i=e.which;e.shiftKey;if(!n._readonly&&n._hasFocus){if(n._onkeydown(e,n),65===i&&(e.ctrlKey||e.metaKey))return n.selectText(),e.preventDefault(),n.render();if(17===i||e.metaKey||e.ctrlKey)return n;if(13===i)e.preventDefault(),n._onsubmit(e,n);else if(9===i&&(e.preventDefault(),t.length>1)){var r=t[n._inputsIndex+1]?n._inputsIndex+1:0;n.blur(),setTimeout(function(){t[r].focus()},10)}return n._value=n._hiddenInput.value,n._cursorPos=n._hiddenInput.selectionStart,n._selection=[0,0],n.render()}},click:function(t,e){var n=e._mousePos(t),i=n.x,r=n.y;return e._endSelection?(delete e._endSelection,void delete e._selectionUpdated):e._canvas&&e._overInput(i,r)||!e._canvas?e._mouseDown?(e._mouseDown=!1,e.click(t,e),e.focus(e._clickPos(i,r))):void 0:e.blur()},mousemove:function(t,e){var n=e._mousePos(t),i=n.x,r=n.y,s=e._overInput(i,r);if(s&&e._canvas?(e._canvas.style.cursor="text",e._wasOver=!0):e._wasOver&&e._canvas&&(e._canvas.style.cursor="default",e._wasOver=!1),e._hasFocus&&e._selectionStart>=0){var o=e._clickPos(i,r),a=Math.min(e._selectionStart,o),h=Math.max(e._selectionStart,o);if(!s)return e._selectionUpdated=!0,e._endSelection=!0,delete e._selectionStart,void e.render();e._selection[0]===a&&e._selection[1]===h||(e._selection=[a,h],e.render())}},mousedown:function(t,e){var n=e._mousePos(t),i=n.x,r=n.y,s=e._overInput(i,r);e._mouseDown=s,e._hasFocus&&s&&(e._selectionStart=e._clickPos(i,r))},mouseup:function(t,e){var n=e._mousePos(t),i=n.x,r=n.y,s=e._clickPos(i,r)!==e._selectionStart;e._hasFocus&&e._selectionStart>=0&&e._overInput(i,r)&&s?(e._selectionUpdated=!0,delete e._selectionStart,e.render()):delete e._selectionStart,e.click(t,e)},selectText:function(t){var e=this,t=t||[0,e._value.length];return setTimeout(function(){e._selection=[t[0],t[1]],e._hiddenInput.selectionStart=t[0],e._hiddenInput.selectionEnd=t[1],e.render()},1),e},renderCanvas:function(){return this._renderCanvas},render:function(t){var e=this,n=e._renderCtx,i=e.outerW,r=e.outerH,s=e._borderRadius,o=e._borderWidth,a=e.shadowW,h=e.shadowH;e.manual&&!t||n&&(t&&n.clearRect(0,0,n.canvas.width,n.canvas.height),n.shadowOffsetX=e._boxShadow.x,n.shadowOffsetY=e._boxShadow.y,n.shadowBlur=e._boxShadow.blur,n.shadowColor=e._boxShadow.color,e._borderWidth>0&&(n.fillStyle=e._borderColor,e._roundedRect(n,e.shadowL,e.shadowT,i-a,r-h,s),n.fill(),n.shadowOffsetX=0,n.shadowOffsetY=0,n.shadowBlur=0),e._drawTextBox(function(){n.shadowOffsetX=0,n.shadowOffsetY=0,n.shadowBlur=0;var t=e._clipText(),d=e._padding+e._borderWidth+e.shadowT;if(e._selection[1]>0){var u=e._textWidth(t.substring(0,e._selection[0])),c=e._textWidth(t.substring(e._selection[0],e._selection[1]));n.fillStyle=e._selectionColor,n.fillRect(d+u,d,c,e._height)}if(e._cursor){var l=e._textWidth(t.substring(0,e._cursorPos));n.fillStyle=e._fontColor,n.fillRect(d+l,d,1,e._height)}var f=e._padding+e._borderWidth+e.shadowL,_=Math.round(d+e._height/2);t=""===t&&e._placeHolder?e._placeHolder:t,n.fillStyle=""!==e._value&&e._value!==e._placeHolder?e._fontColor:e._placeHolderColor,n.font=e._fontStyle+" "+e._fontWeight+" "+e._fontSize+"px "+e._fontFamily,n.shadowColor=e._fontShadowColor,n.shadowBlur=e._fontShadowBlur,n.shadowOffsetX=e._fontShadowOffsetX,n.shadowOffsetY=e._fontShadowOffsetY,n.textAlign="left",n.textBaseline="middle",n.fillText(t,f,_);var p=e._innerShadow.split("px "),g="none"===e._innerShadow?0:parseInt(p[0],10),m="none"===e._innerShadow?0:parseInt(p[1],10),v="none"===e._innerShadow?0:parseInt(p[2],10),y="none"===e._innerShadow?"":p[3];if(v>0){var x=e._shadowCtx,w=x.canvas.width,C=x.canvas.height;x.clearRect(0,0,w,C),x.shadowBlur=v,x.shadowColor=y,x.shadowOffsetX=0,x.shadowOffsetY=m,x.fillRect(-1*i,-100,3*i,100),x.shadowOffsetX=g,x.shadowOffsetY=0,x.fillRect(w,-1*r,100,3*r),x.shadowOffsetX=0,x.shadowOffsetY=m,x.fillRect(-1*i,C,3*i,100),x.shadowOffsetX=g,x.shadowOffsetY=0,x.fillRect(-100,-1*r,100,3*r),e._roundedRect(n,o+e.shadowL,o+e.shadowT,i-2*o-a,r-2*o-h,s),n.clip(),n.drawImage(e._shadowCanvas,0,0,w,C,o+e.shadowL,o+e.shadowT,w,C)}return e._ctx&&(e._ctx.clearRect(e._x,e._y,n.canvas.width,n.canvas.height),e._ctx.drawImage(e._renderCanvas,e._x,e._y)),e}))},destroy:function(){var e=this,n=t.indexOf(e);n!=-1&&t.splice(n,1),e._hasFocus&&e.blur(),document.body.removeChild(e._hiddenInput),e._renderCanvas=null,e._shadowCanvas=null,e._renderCtx=null},_drawTextBox:function(t){var e=this,n=e._renderCtx,i=e.outerW,r=e.outerH,s=e._borderRadius,o=e._borderWidth,a=e.shadowW,h=e.shadowH;if(""===e._backgroundImage)n.fillStyle=e._backgroundColor,e._roundedRect(n,o+e.shadowL,o+e.shadowT,i-2*o-a,r-2*o-h,s),n.fill(),t();else{var d=new Image;d.src=e._backgroundImage,d.onload=function(){n.drawImage(d,0,0,d.width,d.height,o+e.shadowL,o+e.shadowT,i,r),t()}}},_clearSelection:function(){var t=this;if(t._selection[1]>0){var e=t._selection[0],n=t._selection[1];return t._value=t._value.substr(0,e)+t._value.substr(n),t._cursorPos=e,t._cursorPos=t._cursorPos<0?0:t._cursorPos,t._selection=[0,0],!0}return!1},_clipText:function(t){var e=this;t="undefined"==typeof t?e._value:t;var n=e._textWidth(t),i=n/(e._width-e._padding),r=i>1?t.substr(-1*Math.floor(t.length/i)):t;return r+""},_textWidth:function(t){var e=this,n=e._renderCtx;return n.font=e._fontStyle+" "+e._fontWeight+" "+e._fontSize+"px "+e._fontFamily,n.textAlign="left",n.measureText(t).width},_calcWH:function(){var t=this;t.outerW=t._width+2*t._padding+2*t._borderWidth+t.shadowW,t.outerH=t._height+2*t._padding+2*t._borderWidth+t.shadowH},_updateCanvasWH:function(){var t=this,e=t._renderCanvas.width,n=t._renderCanvas.height;t._renderCanvas.setAttribute("width",t.outerW),t._renderCanvas.setAttribute("height",t.outerH),t._shadowCanvas.setAttribute("width",t._width+2*t._padding),t._shadowCanvas.setAttribute("height",t._height+2*t._padding),t._ctx&&t._ctx.clearRect(t._x,t._y,e,n)},_updateHiddenInput:function(){var t=this;t._hiddenInput.style.left=t._x+t._extraX+(t._canvas?t._canvas.offsetLeft:0)+"px",t._hiddenInput.style.top=t._y+t._extraY+(t._canvas?t._canvas.offsetTop:0)+"px",t._hiddenInput.style.width=t._width+2*t._padding+"px",t._hiddenInput.style.height=t._height+2*t._padding+"px"},_roundedRect:function(t,e,n,i,r,s){i<2*s&&(s=i/2),r<2*s&&(s=r/2),t.beginPath(),t.moveTo(e+s,n),t.lineTo(e+i-s,n),t.quadraticCurveTo(e+i,n,e+i,n+s),t.lineTo(e+i,n+r-s),t.quadraticCurveTo(e+i,n+r,e+i-s,n+r),t.lineTo(e+s,n+r),t.quadraticCurveTo(e,n+r,e,n+r-s),t.lineTo(e,n+s),t.quadraticCurveTo(e,n,e+s,n),t.closePath()},_overInput:function(t,e){var n=this,i=t>=n._x+n._extraX,r=t<=n._x+n._extraX+n._width+2*n._padding,s=e>=n._y+n._extraY,o=e<=n._y+n._extraY+n._height+2*n._padding;return i&&r&&s&&o},_clickPos:function(t,e){var n=this,i=n._value;n._value===n._placeHolder&&(i="");var r=n._clipText(i),s=0,o=r.length;if(t-(n._x+n._extraX)<n._textWidth(r))for(var a=0;a<r.length;a++)if(s+=n._textWidth(r[a]),s>=t-(n._x+n._extraX)){o=a;break}return o},_mousePos:function(t){var e=t.target,n=t.pageX,i=t.pageY;t.touches&&t.touches.length?(e=t.touches[0].target,n=t.touches[0].pageX,i=t.touches[0].pageY):t.changedTouches&&t.changedTouches.length&&(e=t.changedTouches[0].target,n=t.changedTouches[0].pageX,i=t.changedTouches[0].pageY);var r=document.defaultView.getComputedStyle(e,void 0),s=parseInt(r.paddingLeft,10)||0,o=parseInt(r.paddingLeft,10)||0,a=parseInt(r.borderLeftWidth,10)||0,h=parseInt(r.borderLeftWidth,10)||0,d=document.body.parentNode.offsetTop||0,u=document.body.parentNode.offsetLeft||0,c=0,l=0;if("undefined"!=typeof e.offsetParent)do c+=e.offsetLeft,l+=e.offsetTop;while(e=e.offsetParent);return c+=s+a+u,l+=o+h+d,{x:n-c,y:i-l}}}}();const __GUIMANAGER_DEBUG_PANEL_NAME="debug-panel",__GUIMANAGER_HELP_PANEL_NAME="help-panel",__GUIMANAGER_WINDOW_NAME="window",__GUIMANAGER_BG_NAME="bg",__GUIMANAGER_TXT_NAME="txt",__GUIMANAGER_CONTAINER_COLOR="#a6a6a6cc",__GUIMANAGER_CONTAINER_WIDTH=250,__GUIMANAGER_CONTAINER_HEIGHT=__GUIMANAGER_CONTAINER_WIDTH,__GUIMANAGER_BUTTON_WIDTH=50,__GUIMANAGER_BUTTON_HEIGHT=50,__GUIMANAGER_BUTTON_FONT_COLOR="#000",__GUIMANAGER_BUTTON_FONT_SIZE=15,__GUIMANAGER_BUTTON_FONT="15px arial",__GUIMANAGER_TXTBOX_WIDTH=100,__GUIMANAGER_TXTBOX_HEIGHT=23;var Layout={calcPreferredSize:function(t){},doLayout:function(t){}},LinedLayout={calcPreferredSize:function(t){},doLayout:function(t){const e=10;for(var n=t.getDimentions(),i=t.getEntityChildren(),r=n.x-e,s=e,o=0;o<i.length;o++){var a=i[o],h=a.getDimentions().y+e;s+=h/2,a.transform&&(a.transform.pos=new Vector2d(0,-n.y/2+s),a.setDimentions(r,-1)),s+=h/2}}};const __EPSILON=1e-8;var MathUtils={toRad:function(t){return t*Math.PI/180},square:function(t){return t*t},greaterThan:function(t,e){return Math.abs(t-e)>=__EPSILON},lesserThan:function(t,e){return MathUtils.greaterThan(e,t)},sign:function(t){return 0==t?0:t/Math.abs(t)}};const Vector={addVector:function(t,e){return t.clone().addVector(e)},subVector:function(t,e){return t.clone().subVector(e)}};