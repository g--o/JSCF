function Animation(t,i,e,n,s){this.spr=i,this.frame=new AnimFrame(0,0,e,n),this.frameCounter=0,this.setAnimationIndex=function(t){this.frame.setAnimationIndex(t,this.spr.image.height)},this.setFrameIndex=function(t){this.frame.setFrameIndex(t,this.spr.image.width)},this.nextAnimation=function(){this.frame.nextAnimation(this.spr.image.height)},this.nextFrame=function(){this.frame.nextFrame(this.spr.image.width)},this.updateFrame=function(){this.frameCounter=(this.frameCounter+1)%Math.floor(t.fps/s),0==this.frameCounter&&this.nextFrame()},this.render=function(){this.spr.start_update(),t.graphics.context.drawImage(this.spr.image,this.frame.px,this.frame.py,this.frame.w,this.frame.h,this.spr.rect.width/-2,this.spr.rect.height/-2,this.spr.rect.width,this.spr.rect.height),this.spr.end_update()}}function AnimFrame(t,i,e,n){this.px=t,this.py=i,this.w=e,this.h=n,this.getAnimationIndex=function(){return this.px/this.w},this.getFrameIndex=function(){return this.py/this.h},this.setAnimationIndex=function(t,i){this.py=(this.py+this.h*t)%i},this.setFrameIndex=function(t,i){this.px=t*this.w%i},this.nextAnimation=function(t){this.py=(this.py+this.h)%t},this.nextFrame=function(t){this.px=(this.px+this.w)%t}}function AnimSprite(t,i,e,n,s,h,r,a,o){this.spr=new Sprite(t,i,e,n,s,h),this.anim=new Animation(t,this.spr,r,a,o),this.interval=null,this.startAnimation=function(){var t=this;null==this.interval?this.interval=setInterval(function(){t.anim.nextFrame()},1/o*1e3):console.warn("JSCF: [startAnimation] animation already started!")},this.stopAnimation=function(){this.interval&&(clearInterval(this.interval),this.interval=null)},this.updateAnim=function(){this.anim.updateFrame()},this.render=function(){this.anim.render()},this.staticRender=function(){this.spr.render()}}function AssetManager(t){this.rules={},this.getExtention=function(t){return t.substring(t.lastIndexOf("."),t.length)},this.getAssetPath=function(i){return t+"\\"+i},this.getAssetDir=function(){return t},this.getRule=function(t){return this.rules[t]},this.setRule=function(t,i){this.rules[t]=i}}function Entity(t,i,e,n){this.name=t,this.alive=i,this.spr=e,this.auto_physics=n,this.auto_render=n,this.auto_update=n,this.render=e.render}function Graphics(t,i){this.init=function(){null==document.body&&alert("JSCF: Fatal error!\nCan't initialize graphics before body is loaded!"),this.canvas=document.createElement("canvas"),t<0?this.canvas.width=window.innerWidth-50:this.canvas.width=t,i<0?this.canvas.height=window.innerHeight-50:this.canvas.height=i,this.context=this.canvas.getContext("2d"),document.body.insertBefore(this.canvas,document.body.childNodes[0])},this.init(),this.clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}}function InputManager(t){function i(t){r[t.keyCode]=!0}function e(t){r[t.keyCode]=!1}function n(i){s=i.clientX-t.offsetLeft,h=i.clientY-t.offsetTop}var s,h,r=[];this.isKeyDownChar=function(t){return r[t.toUpperCase().charCodeAt()]},this.isKeyDown=function(t){return r[t]},this.getMouseX=function(){return s},this.getMouseY=function(){return h},document.addEventListener("keydown",i),document.addEventListener("keyup",e),document.addEventListener("mousemove",n)}function Game(t,i,e,n){this.init=function(){this.state="loading",this.fps=e,this.interval=null,this.inputManager=null,this.assetManager=null,this.graphics=null,this.update=null,this.automated=!0,this.assetManager=new AssetManager(n),this.sceneManager=new SceneManager},this.init(),this.setup=function(){this.graphics=new Graphics(t,i),this.inputManager=new InputManager(this.graphics.canvas)},this.start=function(t,i){"running"!=this.state&&(this.update=t,this.automated=i,this.state="running",this.interval=setInterval(this.handler,1e3/e))},this.stop=function(){null!=this.interval&&clearInterval(this.interval)},this.handler=function(){this.automated&&(this.sceneManager.update(),this.sceneManager.render()),this.update&&this.update()},this.getCanvasWidth=function(){return null!=this.graphics?this.graphics.canvas.width:t},this.getCanvasHeight=function(){return null!=this.graphics?this.graphics.canvas.height:i},this.FPS2AnimSpeed=function(t){return t*this.fps},this.renderText=function(t,i,e,n,s){var h=this.graphics.context;s&&(h.font=s),n&&(h.fillStyle=n),h.fillText(e,t,i)}}function Plane(t,i,e,n,s,h){this.rect=new Rect(t,i,e,n,s),this.color=h,this.render=function(){ctx=t.graphics.context,ctx.fillStyle=this.color,this.rect.render()}}function Point2d(t,i){this.vec=new Vector2d(t,i),this.distanceTo=function(t){return Vector.subVector(this.vec,t.vec).length()},this.setX=function(t){this.vec.x=t},this.setY=function(t){this.vec.y=t},this.getX=function(){return this.vec.x},this.getY=function(){return this.vec.y}}function Rect(t,i,e,n,s,h){this.width=n,this.height=s,this.x=i,this.y=e,this.angle=0,h||(h="box"),this.render=function(){var i=t.graphics.context;i.save(),i.translate(this.x,this.y),i.rotate(this.angle),t.graphics.context.fillRect(this.width/-2,this.height/-2,this.width,this.height),i.restore()},this.containsPoint=function(t,i){return t>this.x&&t<this.x+this.width&&i>this.y&&i<this.y+this.height},this.isColliding=function(t){var i=CollDetectors[h];return i?i(this,t):(console.warn("[JSCF] invalid detector was given to rect object!"),!1)}}function Scene(){this.max_eid=0,this.entities={},this.paused=!1,this.pause=function(){this.paused=!0},this.resume=function(){this.paused=!1},this.update=function(){if(this.paused)return!1;for(entityName in this.entities)if(this.entities.hasOwnProperty(entityName)){var t=this.entities[entityName];t.auto_physics,t.auto_update&&t.update()}return!0},this.render=function(){if(this.paused)return!1;for(entityName in this.entities)if(this.entities.hasOwnProperty(entityName)){var t=this.entities[entityName];t.auto_render&&t.render()}return!0},this.addEntity=function(t){return!(t.name in this.entities)&&(this.entities[t.name]=t,t)},this.createEmptyEntity=function(t,i){return this.entites["empty_entity_"+max_euid]=new Entity(t,!0,i,!0)},this.getEntityName=function(){return max_euid++,"entity_"+max_euid}}function SceneManager(){this.scenes={splash:new Scene},this.cur_scene=this.scenes.splash,this.update=function(){this.cur_scene.update()},this.render=function(){this.cur_scene.render()}}function SoundPlayer(t){this.sound=document.createElement("audio"),this.sound.style.display="none",this.sound.src=t,this.sound.setAttribute("preload","auto"),this.sound.setAttribute("controls","none"),document.body.appendChild(this.sound),this.play=function(){this.sound.play()},this.stop=function(){this.sound.pause()}}function Sprite(t,i,e,n,s,h){this.rect=new Rect(t,i,e,n,s),this.image=new Image,this.image.src=h,this.start_update=function(){var i=t.graphics.context;i.save(),i.translate(this.rect.x,this.rect.y),i.rotate(this.rect.angle)},this.end_update=function(){t.graphics.context.restore()},this.render=function(){this.start_update(),t.graphics.context.drawImage(this.image,0,0,this.image.width,this.image.height,this.rect.width/-2,this.rect.height/-2,this.rect.width,this.rect.height),this.end_update()},this.setImageSrcFromAsset=function(i){this.image.src=t.assetManager.getAssetPath(i)}}function Vector2d(t,i){this.x=t,this.y=i,this.add=function(t,i){return this.x+=t,this.y+=i,this},this.sub=function(t,i){return this.add(-t,-i)},this.addVector=function(t){return this.add(t.x,t.y)},this.subVector=function(t){return this.sub(t.x,t.y)},this.length=function(){return Math.sqrt(MathUtils.square(this.x)+MathUtils.square(this.y))},this.getNormal=function(){var t=this.length();return 0!=t?new Vector2d(this.x/t,this.y/t):new Vector2d(0,0)},this.normalize=function(){var t=this.length();this.x/=t,this.y/=t},this.dotProduct=function(t){return this.x*t.x+this.y*t.y},this.makeArray=function(){return[this.x,this.y]},this.clone=function(){return new Vector2d(this.x,this.y)}}var CollDetectors={circle:function(t,i){return t.center-i.center<=cricle1.R+i.R},box:function(t,i){var e=t.x-t.width/2,n=i.x-i.width/2,s=t.y-t.height/2,h=i.y-i.height/2,r=e+t.width,a=n+i.width,o=s+t.height,c=h+i.height;return e<a&&r>n&&s<c&&o>h}},MathUtils={toRad:function(t){return t*Math.PI/180},square:function(t){return t*t}},SceneUtils={makeFloor:function(t,i,e,n,s,h){for(var r=[],a=0;a<n/s;a++)r[a]=new Sprite(t,i+s*a+s/2,e+t.getCanvasHeight()-s/2,s,s,h);return r}};const Vector={addVector:function(t,i){return t.clone().addVector(i)},subVector:function(t,i){return t.clone().subVector(i)}};