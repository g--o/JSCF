function AssetManager(assetsDir){this.rules={};function getExtention(name){}this.getAssetPath=function(name){return assetsDir+"\\"+name};this.getAssetDir=function(){return assetsDir};this.getRule=function(ext){return this.rules[ext]};this.setRule=function(ext,dir){this.rules[ext]=dir}}function Graphics(canvasWidth,canvasHeight){this.init=function(){if(document.body==null){alert("JSCF: Fatal error!\nCan't initialize graphics before body is loaded!")}this.canvas=document.createElement("canvas");if(canvasWidth<0)this.canvas.width=window.innerWidth-50;else this.canvas.width=canvasWidth;if(canvasHeight<0)this.canvas.height=window.innerHeight-50;else this.canvas.height=canvasHeight;this.context=this.canvas.getContext("2d");document.body.insertBefore(this.canvas,document.body.childNodes[0])};this.init();this.clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}}function InputManager(){var keys=[];this.isKeyDownChar=function(c){return keys[c.toUpperCase().charCodeAt()]};this.isKeyDown=function(code){return keys[code]};function updateKeyTrue(e){keys[e.keyCode]=true}function updateKeyFalse(e){keys[e.keyCode]=false}document.addEventListener("keydown",updateKeyTrue);document.addEventListener("keyup",updateKeyFalse)}function Game(canvasWidth,canvasHeight,fps,assetDir){this.init=function(){this.state="loading";this.fps=fps;this.interval=null;this.inputManager=null;this.assetManager=null;this.graphics=null;this.inputManager=new InputManager;this.assetManager=new AssetManager(assetDir)};this.init();this.setup=function(){this.graphics=new Graphics(canvasWidth,canvasHeight)};this.start=function(update){if(this.state!="running"){this.interval=setInterval(update,1e3/fps);this.state="running"}};this.stop=function(){if(this.interval!=null)clearInterval(this.interval)};this.getCanvasWidth=function(){if(this.graphics!=null)return this.graphics.canvas.width;else return canvasWidth};this.getCanvasHeight=function(){if(this.graphics!=null)return this.graphics.canvas.height;else return canvasHeight}}var MathUtils={toRad:function(deg){return deg*Math.PI/180}};function Rect(game,x,y,width,height){this.width=width;this.height=height;this.x=x;this.y=y;this.angle=0;this.render=function(){var ctx=game.graphics.context;ctx.save();ctx.translate(this.x,this.y);ctx.rotate(this.angle);game.graphics.context.fillRect(this.width/-2,this.height/-2,this.width,this.height);ctx.restore()};this.isColliding=function(rect){var x1=this.x-this.width/2;var x2=rect.x-rect.width/2;var y1=this.y-this.height/2;var y2=rect.y-rect.height/2;if(x1<x2+rect.width&&x1+this.width>x2&&y1>y2-rect.height&&-this.height+this.y<y2){return true}return false}}function Plain(game,x,y,width,height,color){this.rect=new Rect(game,x,y,width,height);this.render=function(){ctx=game.graphics.context;ctx.fillStyle=color;this.rect.render()}}var SceneUtils={makeFloor:function(game,x,y,floor_width,tile_width,type){var platforms=[];for(var i=0;i<floor_width/tile_width;i++)platforms[i]=new Sprite(game,x+64*i+32,y+game.getCanvasHeight()-32,64,64,type);return platforms}};function Sprite(game,x,y,width,height,url){this.rect=new Rect(game,x,y,width,height);this.image=new Image;this.image.src=url;this.render=function(){var ctx=game.graphics.context;ctx.save();ctx.translate(this.rect.x,this.rect.y);ctx.rotate(this.rect.angle);ctx.drawImage(this.image,this.rect.width/-2,this.rect.height/-2,this.rect.width,this.rect.height);ctx.restore()};this.setImageSrcFromAsset=function(asset){this.image.src=game.assetManager.getAssetPath(asset)}}